<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMOFLOW</title>

<style>
body {
    margin:0;
    background:#000;
    color:#fff;
    font-family: monospace;
    overflow-x:hidden;
}

h1, h2 {
    text-align:center;
    letter-spacing:2px;
}

.glitch {
    position: relative;
    color: white;
}
.glitch::before,
.glitch::after {
    content: attr(data-text);
    position: absolute;
    left: 0;
    width: 100%;
    overflow: hidden;
}
.glitch::before {
    animation: glitchTop 3s infinite linear alternate-reverse;
    color: #0ff;
}
.glitch::after {
    animation: glitchBottom 2s infinite linear alternate-reverse;
    color: #f0f;
}

@keyframes glitchTop {
    0% { clip-path: inset(0 0 90% 0); transform: translate(-2px,-2px);}
    100% { clip-path: inset(10% 0 60% 0); transform: translate(2px,2px);}
}
@keyframes glitchBottom {
    0% { clip-path: inset(80% 0 0 0); transform: translate(2px,0);}
    100% { clip-path: inset(60% 0 10% 0); transform: translate(-2px,0);}
}

.section {
    padding:60px 20px;
    max-width:1000px;
    margin:auto;
}

canvas {
    display:block;
    margin:auto;
    background:#000;
    border:1px solid #222;
}

select {
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:5px;
}

.metric {
    text-align:center;
    font-size:18px;
    margin-top:15px;
}
</style>
</head>

<body>

<div class="section">
    <h1 class="glitch" data-text="EMOFLOW Territory">EMOFLOW Territory</h1>
    <h2>Modelo dinámico territorial</h2>
</div>

<div class="section">
    <h2>ISET — Índice de Saturación Emocional Territorial</h2>
    <canvas id="isetChart" width="800" height="300"></canvas>
</div>

<div class="section">
    <h2>IRET — Índice de Riesgo Emocional Territorial</h2>
    <div class="metric">Valor dinámico IRET: <span id="iretValue">0</span></div>
</div>

<div class="section">
    <h2>Heatmap Territorial</h2>

    <label>Seleccionar territorio:</label>
    <select id="territorySelect">
        <option value="urbano">Zona Urbana</option>
        <option value="turistico">Zona Turística</option>
        <option value="periferico">Zona Periférica</option>
    </select>

    <canvas id="heatmap" width="800" height="400"></canvas>
</div>

<script>

// ---------------- ISET + IRET ----------------

const canvas = document.getElementById("isetChart");
const ctx = canvas.getContext("2d");

let time = 0;
let IRET = 0;
const criticalThreshold = 75;

function drawChart() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle = "#0f0";
    ctx.beginPath();

    for(let x=0;x<canvas.width;x++){
        let value = 50 + 30*Math.sin((x+time)/50);
        let y = canvas.height - (value*3);
        if(x===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    }
    ctx.stroke();

    // Critical line
    ctx.strokeStyle = "red";
    ctx.beginPath();
    ctx.moveTo(0, canvas.height - criticalThreshold*3);
    ctx.lineTo(canvas.width, canvas.height - criticalThreshold*3);
    ctx.stroke();

    ctx.fillStyle = "red";
    ctx.fillText("CRITICAL ISET", 10, canvas.height - criticalThreshold*3 - 5);

    IRET = Math.abs(50 + 30*Math.sin(time/40));
    document.getElementById("iretValue").innerText = IRET.toFixed(2);

    time++;
    requestAnimationFrame(drawChart);
}

drawChart();


// ---------------- HEATMAP ----------------

const heatCanvas = document.getElementById("heatmap");
const heatCtx = heatCanvas.getContext("2d");
const selector = document.getElementById("territorySelect");

function drawHeatmap() {
    heatCtx.clearRect(0,0,heatCanvas.width,heatCanvas.height);

    let densityFactor;

    switch(selector.value){
        case "urbano": densityFactor = 1.2; break;
        case "turistico": densityFactor = 1.5; break;
        case "periferico": densityFactor = 0.8; break;
    }

    for(let i=0;i<100;i++){
        let x = Math.random()*heatCanvas.width;
        let y = Math.random()*heatCanvas.height;

        let intensity = IRET * densityFactor;

        let radius = intensity/2;

        let gradient = heatCtx.createRadialGradient(x,y,0,x,y,radius);
        gradient.addColorStop(0,"rgba(255,0,0,"+(intensity/100)+")");
        gradient.addColorStop(1,"rgba(255,0,0,0)");

        heatCtx.fillStyle = gradient;
        heatCtx.fillRect(x-radius,y-radius,radius*2,radius*2);
    }

    requestAnimationFrame(drawHeatmap);
}

drawHeatmap();

</script>

</body>
</html>
